<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:decorate template="/resources/templates/template.xhtml">	

        <!-- Center Content -->
        <ui:define name="conteudo_centro">
            <h:form id="form">
                <p:growl id="growl" autoUpdate="true" showDetail="true"
                         showSummary="true" />      

                <p:wizard nextLabel="Avançar" backLabel="Voltar" flowListener="#{pipelineComposerBean.flowController}">
                    <!-- Element selection tab -->
                    <p:tab id="element_selection" title="1. Seleção de Elementos">
                        <p:panel header="Escolha os elementos deste Workflow">
                            <p:panel style="border-color: #34495e">
                                <p:outputLabel value="Escolha os elementos que irão compor este workflow." />
                            </p:panel> 
                            <br />
                            <p:fieldset legend="Elementos disponíveis" style="border-color: #16a085">
                                <center>
                                    <p:dataGrid var="p" value="#{pipelineComposerBean.programList}" columns="4" layout="grid"
                                                id="elements" >
                                        <f:facet name="header" >
                                            Elementos
                                        </f:facet>

                                        <p:panel header="#{p.name}" style="text-align:center">
                                            <h:panelGrid columns="1" style="width:100%">
                                                <h:outputText value="#{p.description}" />
                                                <hr style="color: #3498db"/>
                                                <f:facet name="footer">
                                                    <p:commandButton action="#{pipelineComposerBean.addElement(p)}"
                                                                     value="Adicionar" icon="ui-icon-circle-plus" update=":form:chosen_elements, :form:growl"
                                                                     iconPos="left" />
                                                </f:facet>
                                            </h:panelGrid>
                                        </p:panel>

                                    </p:dataGrid>
                                </center>
                            </p:fieldset>
                            <br />
                            <p:fieldset id="chosen_elements" legend="Elementos escolhidos" style="border-color: #f39c12">
                                <center>
                                    <p:dataTable value="#{pipelineComposerBean.chosenPrograms}" var="p" style="width: 400px"
                                                 emptyMessage="Nenhum elemento adicionado" paginator="true" rows="8">
                                        <p:column headerText="Elemento">
                                            <p:outputLabel value="#{p.name}"/>
                                        </p:column>
                                        
                                        <p:column headerText="Excluir" style="text-align: center">
                                            <p:commandButton icon="ui-icon-circle-close" action="#{pipelineComposerBean.removeElement(p)}" update=":form:chosen_elements"/>
                                        </p:column>
                                    </p:dataTable>
                                </center>
                            </p:fieldset>
                        </p:panel>
                    </p:tab>

                    <p:tab id="workflow_design" title="2. Desenho do Workflow">
                        <p:panel header="Descrição">
                            Dê uma breve descrição para esse workflow: <br /> <br />
                            <p:inputText style="width: 99%" value="#{pipelineComposerBean.workflowDescription}"/>
                        </p:panel>
                        <br />

                        <p:panel id="workflow_pnl">   
                            <!-- ======== Diagram ======== -->
                            <p:panel>
                                <f:facet name="header">
                                    <center>
                                        <p:outputLabel value="Diagrama" />
                                    </center>
                                </f:facet>
                                <p:diagram id="workflow_diagram"
                                           value="#{pipelineComposerBean.workflowModel}"
                                           style="height:500px" >
                                    <p:ajax event="connect" listener="#{pipelineComposerBean.onConnect}" />
                                    <p:ajax event="disconnect" listener="#{pipelineComposerBean.onDisconnect}" />
                                    <p:ajax event="connectionChange" listener="#{pipelineComposerBean.onConnectionChange}" />
                                </p:diagram>
                            </p:panel>
                        </p:panel>
                    </p:tab>
                </p:wizard>
            </h:form>
        </ui:define>

    </ui:decorate>
    <!-- ***************************************************************************************************************** -->
    <!--                                                        DIALOGS                                                    -->
    <!-- ***************************************************************************************************************** -->

    <!-- File Dialog: Used for the user to pick inputs -->
    <p:dialog widgetVar="file_dlg" header="Escolha a entrada desse passo" showEffect="fade" hideEffect="fade" modal="true" >
        <p:panel>
            <p:panel>
                Escolha se a entrada deste passo será um arquivo ou uma URL do arquivo
            </p:panel>
            <br />
            <p:tabView>
                <p:tab title="Arquivos">
                    <p:dataTable value="#{pipelineComposerBean.loggedUser.files}" var="f" style="width: 60em"
                                 paginator="true" rows="5" emptyMessage="Nenhum arquivo encontrado">
                        <f:facet name="header">Sua lista de arquivos</f:facet>
                        <p:column headerText="ID" width="5em" style="text-align: center">
                            <p:outputLabel value="#{f.id}"/>
                        </p:column>

                        <p:column headerText="Nome" width="25em" style="text-align: center">
                            <p:outputLabel value="#{f.name}"/>
                        </p:column>

                        <p:column headerText="Upload em" width="25em" style="text-align: center">
                            <p:outputLabel value="#{f.uploadTimestamp}"/>
                        </p:column>

                        <p:column headerText="Tamanho" width="25em" style="text-align: center">
                            <p:outputLabel value="#{f.size} Kb"/>
                        </p:column>

                        <p:column headerText="Escolher arquivo" width="25em" style="text-align: center">
                            <p:commandButton icon="ui-icon-check" iconPos="center" 
                                             action="#{pipelineComposerBean.addElement(f)}" 
                                             update=":form:workflow_pnl, :form:growl"
                                             onclick="PF('file_dlg').hide()"/>
                        </p:column>
                    </p:dataTable>
                    <br />
                    <p:panel>
                        Caso não tenho realizado o upload dos arquivos necessários para essa execução, faça-o 
                        <p:commandLink value="aqui" action="upload_file"/>
                    </p:panel>
                </p:tab>
                <p:tab title="URL">
                    Digite a URL de onde se encontra seu arquivo (URL de um armazenamento, link do Dropbox, link do Google Drive, ...). <br />
                    Apontar o caminho direto para o arquivo (nao apontar pastas, por exemplo):
                    <p:inputText style="width: 99%" placeholder="http://" />
                    <br /> <br />
                    <p:commandButton value="Ok"/>
                </p:tab>
            </p:tabView>

        </p:panel>
    </p:dialog>

    <!-- Final confirmation -->
    <p:confirmDialog message="Você tem certeza que deseja finalizar este Workflow?"
                     header="Finalizar workflow" severity="alert"
                     widgetVar="confirm_end">
        <center>
            <p:commandButton value="Sim" onclick="PF('confirm_end').hide()" action="#{pipelineComposerBean.endWorkflow()}" update=":form:workflow_pnl"/>
            <p:commandButton value="Não" onclick="PF('confirm_end').hide();" />
        </center>
    </p:confirmDialog>
</html>